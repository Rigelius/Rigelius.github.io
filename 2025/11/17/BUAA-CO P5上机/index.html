<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>BUAA-CO P5上机 | Rigelius Blog</title><meta name="author" content="Rigelius"><meta name="copyright" content="Rigelius"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本节考查内容为 Verilog 实现流水线 CPU。 课上题目 T1 ccc ccc-rs-rt-rd RTL 123456temp1 &lt;- count_leading_zeros(GPR[rs])temp2 &lt;- count_leading_ones(GPR[rt])if (temp1 &gt; temp2)    GPR[rd] &lt;- GPR[rs][31:16]">
<meta property="og:type" content="article">
<meta property="og:title" content="BUAA-CO P5上机">
<meta property="og:url" content="https://rigelius.github.io/2025/11/17/BUAA-CO%20P5%E4%B8%8A%E6%9C%BA/index.html">
<meta property="og:site_name" content="Rigelius Blog">
<meta property="og:description" content="本节考查内容为 Verilog 实现流水线 CPU。 课上题目 T1 ccc ccc-rs-rt-rd RTL 123456temp1 &lt;- count_leading_zeros(GPR[rs])temp2 &lt;- count_leading_ones(GPR[rt])if (temp1 &gt; temp2)    GPR[rd] &lt;- GPR[rs][31:16]">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://rigelius.github.io/img/covers/cover4.jpg">
<meta property="article:published_time" content="2025-11-17T14:00:00.000Z">
<meta property="article:modified_time" content="2026-02-12T16:19:12.000Z">
<meta property="article:author" content="Rigelius">
<meta property="article:tag" content="CO">
<meta property="article:tag" content="Verilog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://rigelius.github.io/img/covers/cover4.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "BUAA-CO P5上机",
  "url": "https://rigelius.github.io/2025/11/17/BUAA-CO%20P5%E4%B8%8A%E6%9C%BA/",
  "image": "https://rigelius.github.io/img/covers/cover4.jpg",
  "datePublished": "2025-11-17T14:00:00.000Z",
  "dateModified": "2026-02-12T16:19:12.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Rigelius",
      "url": "https://Rigelius.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://rigelius.github.io/2025/11/17/BUAA-CO%20P5%E4%B8%8A%E6%9C%BA/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'BUAA-CO P5上机',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"></head><body><div class="bg-animation" id="web_bg" style="background-color: #f0f0f0;"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/covers/cover4.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Rigelius Blog</span></a><a class="nav-page-title" href="/"><span class="site-name">BUAA-CO P5上机</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><span class="site-page custom-search-btn"><i class="fa-fw fas fa-search"></i><span> Search</span></span></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 目录</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/friends/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><span class="site-page custom-theme-toggle"><i class="fa-fw fas fa-moon"></i></span></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">BUAA-CO P5上机</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-11-17T14:00:00.000Z" title="发表于 2025-11-17 22:00:00">2025-11-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-02-12T16:19:12.000Z" title="更新于 2026-02-13 00:19:12">2026-02-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90/">计算机组成</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p>本节考查内容为 Verilog 实现流水线 CPU。</p>
<h2 id="课上题目">课上题目</h2>
<h3 id="t1-ccc">T1 ccc</h3>
<p><code>ccc</code>-<code>rs</code>-<code>rt</code>-<code>rd</code></p>
<h4 id="rtl">RTL</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">temp1 &lt;- count_leading_zeros(GPR[rs])</span><br><span class="line">temp2 &lt;- count_leading_ones(GPR[rt])</span><br><span class="line"><span class="keyword">if</span> (temp1 &gt; temp2)</span><br><span class="line">    GPR[rd] &lt;- GPR[rs][<span class="number">31</span>:<span class="number">16</span>] || GPR[rt][<span class="number">15</span>:<span class="number">0</span>]</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    GPR[rd] &lt;- GPR[rt][<span class="number">31</span>:<span class="number">16</span>] || GPR[rs][<span class="number">15</span>:<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<h3 id="t2-cjoc">T2 cjoc</h3>
<p><code>cjoc</code>-<code>rs</code>-<code>rt</code>-<code>offset</code></p>
<h4 id="rtl-1">RTL</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ext_offset &lt;- sign_ext(offset||<span class="number">00</span>)</span><br><span class="line">id &lt;- ext_offset[<span class="number">4</span>:<span class="number">2</span>]</span><br><span class="line">temp &lt;- GPR[rs][id + <span class="number">7</span> : id]</span><br><span class="line">condition &lt;- (temp &gt; <span class="number">8&#x27;d21</span>)</span><br><span class="line"><span class="keyword">if</span> (condition)</span><br><span class="line">    GPR[rt] &lt;- PC + <span class="number">8</span></span><br><span class="line">    PC &lt;- PC + <span class="number">4</span> + ext_offset</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    NullifyCurrentInstruction()</span><br></pre></td></tr></table></figure>
<h3 id="t3-ccs">T3 ccs</h3>
<p><code>ccs</code>-<code>base</code>-<code>rt</code>-<code>offset</code></p>
<h4 id="rtl-2">RTL</h4>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vAddr &lt;- GPR[base] + sign_ext(offset)</span><br><span class="line">pAddr &lt;- vAddr[<span class="number">31</span>:<span class="number">2</span>]||<span class="number">00</span></span><br><span class="line">memword &lt;- memory[pAddr]</span><br><span class="line">high_ones &lt;- count_ones(memword[<span class="number">31</span>:<span class="number">16</span>])</span><br><span class="line">low_ones &lt;- count_ones(memword[<span class="number">15</span>:<span class="number">0</span>])</span><br><span class="line"><span class="keyword">if</span> (high_ones &gt; low_ones)</span><br><span class="line">    dest_reg &lt;- <span class="number">31</span></span><br><span class="line">    GPR[dest_reg] &lt;- memword ^ GPR[rt]</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    dest_reg &lt;- high_ones</span><br><span class="line">    GPR[dest_reg] &lt;- memword ^ GPR[rt]</span><br></pre></td></tr></table></figure>
<h2 id="题目分析">题目分析</h2>
<p>T1 是运算类指令，经历了 P3 和 P4，应该对这种题目很熟悉了。T2 是
<code>bltzal</code>（条件跳转并链接）的变体，可能的难点是清空延迟槽如何表示，具体可以参考往届博客，其等价于让
FD 级流水线寄存器将原指令替换成 <code>nop</code>，即
<code>REG_D_flush = newSign &amp;&amp; !D_b_jump &amp;&amp; !stall</code>，式中
<code>newSign</code> 是我从 <code>D_CTRL</code>
中新接出来的输出端口，当且仅当是该 <code>ccc</code> 指令时置 1。</p>
<p>T3 是条件访存题，主要的难点是不能无脑阻塞，而是要分析可能的 GRF
写地址。<code>ccs</code> 的写寄存器地址只可能是 1~16 和 31，所以如果 D
级是读寄存器的指令，而且读的寄存器在上面的范围，而且 E 和 M 级是
<code>ccs</code> 指令时，就要阻塞了。但这道题我到最后还是有两个点
TLE，经过课后反思，因为我是在 W 级才将 <code>dest_reg</code>
修改正确，其实在 M 级读出 data 后就完全可以了，因此是这里导致了
TLE。</p>
<h2 id="助教问答">助教问答</h2>
<p>以下为部分问题：</p>
<ul>
<li>看看测试程序和设计文档</li>
<li>我清空延迟槽是如何学会的</li>
<li>为什么要设计延迟槽</li>
<li>讲一下第二题的解题思路</li>
</ul>
<h2 id="笔者的话">笔者的话</h2>
<p>从 P4 到 P5
可谓一座高山，从单周期到流水线，有太多的模块需要修改和完善，即使写完了，那么通过课下测试也是一个难点。建议多用评测机对拍，可以和
MARS 对拍，也可以和同学甚至往届的 CPU 对拍。对 CPU
的控制单元，指令分类我认为是一个好的做法，我将指令分成了这几类：<code>load</code>、<code>store</code>、<code>calcR</code>、<code>calcI</code>、<code>branch</code>、<code>jumpR</code>、<code>jumpI</code>、<code>jumpLink</code>、<code>branchLink</code>
这几类（命名不太规范，见谅），每一类指令的相关控制信号和阻塞逻辑都大致是相同的。上机时将新指令归入相应的类会节省很多时间，比如是
I 型计算类指令，就归入 <code>calcI</code>
类，那么阻塞模块中基本就不用再修改了。不过对于一些特殊的指令，需要将其归入多个类，具体细节还需要自己研究透彻。</p>
<p>P5
的题目也有一些新变化，比如跳转题会有清空延迟槽，访存题会有条件访存。建议自己尝试添加一下
<code>bltzal</code>
指令，这个和考试的跳转题目比较类似。课程网站上也有推荐题目，一些经典题，比如
<code>bonall</code>、<code>blztal</code>、<code>lhogez</code>
等，上机前还是多做一做，确保理解了各个指令的数据通路。如果看不到推荐题（少数人有这种情况），可以用脚本爬一下
cscore
平台（爬虫的方法和结果见我另一篇帖子）。清空延迟槽可以将正确的代码先放到注释中，有备无患。然后多给
CPU 预留一些接口，比如条件访存题，写入的寄存器值或地址直到 M
级才知道，我一般是在顶层的 M 级直接修正，我在 CTRL
模块中直接引出了一个新信号
<code>Use_Dynamic_A3</code>，对于条件访存指令，这个控制信号的输出值就是
1。同时也可以发现，题目中经常有求前导 0 的个数、前导 1
的个数等函数，因此课下就准备好相关函数模板，上机时直接用，避免重复造轮子。以下是我的函数模板：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意：一定先把位宽改成你所需要的位宽再使用这些函数！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算前导0个数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] lead0;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    lead0=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">31</span>;i&gt;=<span class="number">0</span>;i=i-<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">0</span>) lead0=lead0+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> i=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算前导1个数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] lead1;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    lead1=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">31</span>;i&gt;=<span class="number">0</span>;i=i-<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">1</span>) lead1=lead1+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> i=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算后导0个数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] trail0;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    trail0=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">0</span>) trail0=trail0+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> i=<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 计算后导1个数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] trail1;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    trail1=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">1</span>) trail1=trail1+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> i=<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 统计0的个数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] cnt0;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    cnt0=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        cnt0=cnt0+!x[i];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 统计1的个数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] cnt1;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    cnt1=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        cnt1=cnt1+x[i];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最高位1的位置</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] highbit1;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    highbit1=<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">31</span>;i&gt;=<span class="number">0</span>;i=i-<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">            highbit1=i;</span><br><span class="line">            i=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最高位0的位置</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] highbit0;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    highbit0=<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">31</span>;i&gt;=<span class="number">0</span>;i=i-<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">            highbit0=i;</span><br><span class="line">            i=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最低位1的位置</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] lowbit1;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    lowbit1=<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">            lowbit1=i;</span><br><span class="line">            i=<span class="number">32</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最低位0的位置</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] lowbit0;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    lowbit0=<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(x[i]==<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">            lowbit0=i;</span><br><span class="line">            i=<span class="number">32</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否为完全平方数</span></span><br><span class="line"><span class="keyword">function</span> is_square;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    is_square=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i*i&lt;=x;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(i*i==x)<span class="keyword">begin</span></span><br><span class="line">            is_square=<span class="number">1</span>;</span><br><span class="line">            i=x+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不大于该数的最大完全平方数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] max_square;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    max_square=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i*i&lt;=x &amp;&amp; i&lt;=<span class="number">46340</span>; i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        max_square=i*i;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否为质数</span></span><br><span class="line"><span class="keyword">function</span> is_prime;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(x &lt; <span class="number">2</span>) is_prime = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        is_prime = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">2</span>; i*i&lt;=x; i=i+<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(x%i==<span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                is_prime = <span class="number">0</span>;</span><br><span class="line">                i = x;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不大于该数的最大质数</span></span><br><span class="line"><span class="keyword">function</span> [<span class="number">31</span>:<span class="number">0</span>] max_prime;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] x;</span><br><span class="line"><span class="keyword">integer</span> i, j;</span><br><span class="line"><span class="keyword">reg</span> is_p;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    max_prime=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=x; i&gt;=<span class="number">2</span>; i=i-<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">        is_p=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">2</span>; j*j&lt;=i; j=j+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span>(i%j==<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                is_p=<span class="number">0</span>;</span><br><span class="line">                j=i;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span>(is_p)<span class="keyword">begin</span></span><br><span class="line">            max_prime=i;</span><br><span class="line">            i=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endfunction</span></span><br></pre></td></tr></table></figure>
<p>关于上机时的 debug，我的建议是将<a
target="_blank" rel="noopener" href="https://github.com/Toby-Shi-cloud/Mars-with-BUAA-CO-extension">魔改版
MARS</a>也打包交上去，如果某题 WA 了，自己编写一段测试程序，先用
<code>testbench</code> 仿真得到相应输出，再用魔改版 MARS
得到正确的输出（注意：上机时提供的课程组 MARS 和上面这个也不同，上面的
MARS 对每条写 GRF 或者 DM
的指令都会输出结果，而课程组提供的不能），再直接将两个输出对比，尽量不要看复杂的波形图了。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://Rigelius.github.io">Rigelius</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://rigelius.github.io/2025/11/17/BUAA-CO%20P5%E4%B8%8A%E6%9C%BA/">https://rigelius.github.io/2025/11/17/BUAA-CO%20P5%E4%B8%8A%E6%9C%BA/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://Rigelius.github.io" target="_blank">Rigelius Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CO/">CO</a><a class="post-meta__tags" href="/tags/Verilog/">Verilog</a></div><div class="post-share"><div class="social-share" data-image="/img/covers/cover4.jpg" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/12/01/BUAA-CO%20P6%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P6上机"><img class="cover" src="/img/covers/cover14.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">BUAA-CO P6上机</div></div><div class="info-2"><div class="info-item-1">本节考查内容为 Verilog 实现流水线 CPU。 第一次课上题目 T1 mygo mygo-rs-rt RTL 123456789101112131415161718192021222324function pattern_value(g):    return count_leading_zeros(g) * 2 + count_ones(g)function characteristic_code(A):    sum &lt;- 0    for i in 0..7:        g &lt;- A[4*i+3 : 4*i]        sum &lt;- sum + pattern_value(g) * (i + 1)    return sum    MDU_Start(Busy_Cycles = 5)temp1 &lt;- characteristic_code(GPR[rs])temp2 &lt;- characteristic_code(GPR[rt])if (temp1 &gt; temp2)    HI &lt;- GPR[rs]    LO...</div></div></div></a><a class="pagination-related" href="/2025/11/11/BUAA-OOpre%20%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/" title="BUAA-OOpre 课程总结"><img class="cover" src="/img/covers/cover9.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">BUAA-OOpre 课程总结</div></div><div class="info-2"><div class="info-item-1">一、架构设计 继承与接口设计 项目最终UML类图如下：  采用模块化的思想，我的最终架构可以分为以下几个核心模块： 1. 入口与控制层  Main：程序入口，仅用于初始化Scanner、冒险者容器advs、关系管理器rm，并创建总控制器CommandUtil。 CommandUtil：系统的总控制器。  控制：负责解析所有用户命令。它从Main接收Scanner，通过switch语句分发指令（ “aa”, “ab”, “fight”, “use” 等）。 协作：作为协调者，调用 Adventurer 类的业务方法和 RelationManager 的关系处理方法。   2. 核心实体层  Adventurer：管理冒险者的所有属性和行为。  属性管理：管理基础属性（hitPoint, baseAtk, baseDef, mana, money）及状态（dead）。 物品管理：  items：存储冒险者拥有的所有物品。 bottleBackpack：药水瓶背包，采用LinkedHashMap这一数据结构，通过重写removeEld...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/11/10/BUAA-CO%20P4%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P4上机"><img class="cover" src="/img/covers/cover2.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-10</div><div class="info-item-2">BUAA-CO P4上机</div></div><div class="info-2"><div class="info-item-1">本节考查内容为 Verilog 实现单周期 CPU。 课上题目 T1 brc brc-rs-rt-rd RTL 12345temp &lt;- GPR[rs][4:0]if (temp &lt; 25 &amp;&amp; count_ones(GPR[rt][temp+7:temp]) % 2 == 0)    GPR[rd] &lt;- reverse(GPR[rt])else    GPR[rd] &lt;- GPR[rt] T2 cabc cabc-rs-rt-offset RTL 123456789cross1 &lt;- GPR[rs][23:16]||GPR[rt][7:0]||GPR[rs][31:24]||GPR[rt][15:8]cross2 &lt;- GPR[rt][7:0]||GPR[rs][23:16]||GPR[rt][31:24]||GPR[rs][15:8]xor_result &lt;- cross1 ^ cross2cnt1 &lt;- count_zeros(xor_result[31:16])cnt2 &lt;- cou...</div></div></div></a><a class="pagination-related" href="/2025/12/01/BUAA-CO%20P6%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P6上机"><img class="cover" src="/img/covers/cover14.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-01</div><div class="info-item-2">BUAA-CO P6上机</div></div><div class="info-2"><div class="info-item-1">本节考查内容为 Verilog 实现流水线 CPU。 第一次课上题目 T1 mygo mygo-rs-rt RTL 123456789101112131415161718192021222324function pattern_value(g):    return count_leading_zeros(g) * 2 + count_ones(g)function characteristic_code(A):    sum &lt;- 0    for i in 0..7:        g &lt;- A[4*i+3 : 4*i]        sum &lt;- sum + pattern_value(g) * (i + 1)    return sum    MDU_Start(Busy_Cycles = 5)temp1 &lt;- characteristic_code(GPR[rs])temp2 &lt;- characteristic_code(GPR[rt])if (temp1 &gt; temp2)    HI &lt;- GPR[rs]    LO...</div></div></div></a><a class="pagination-related" href="/2025/10/20/BUAA-CO%20P1%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P1上机"><img class="cover" src="/img/covers/cover6.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-20</div><div class="info-item-2">BUAA-CO P1上机</div></div><div class="info-2"><div class="info-item-1">本节考查内容为 Verilog，一般是一道组合逻辑和两道时序逻辑，时序逻辑中一个是有限状态机。 课上题目 T1 异或卷积 任务描述 我们需要设计一个 Verilog 模块，模拟卷积神经网络中的卷积操作。 给定一个 \(6 \times 6\) 的输入矩阵 \(a\) 和一个 \(3 \times 3\) 的卷积核 \(b\)，计算输出一个 \(4 \times 4\) 的特征图 \(ans\)。 数据映射 输入和输出均以一维向量形式给出，需按照“行优先”原则映射为二维矩阵。 数据转换规则为：从低位到高位依次填入矩阵，先填满第 0 行，再填满第 1 行，以此类推。 矩阵第 \(i\) 行、第 \(j\) 列的元素 \(M[i][j]\)（行列均从 0 开始计数）的值，等于向量 \(a\) 的第 \(i \times n + j\) 位。数学公式表达为： \[M[i][j] = a_{i \times n + j}\]  输入 \(a\)：位宽 36，对应 \(6 \times 6\) 矩阵。 输入 \(b\)：位宽 9，对应 \(3 \t...</div></div></div></a><a class="pagination-related" href="/2025/12/08/BUAA-CO%20P7%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P7上机"><img class="cover" src="/img/covers/cover10.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-08</div><div class="info-item-2">BUAA-CO P7上机</div></div><div class="info-2"><div class="info-item-1">本节考查内容为 Verilog 实现 MIPS 微系统，支持中断和异常。 课上题目 T1~T4 都是课下强测，分别是功能强测、异常强测、中断强测、冲突强测。 T5 monitor 在 P7 系统中（DM 范围 0x0000 ~ 0x2fff），新增一套内存监视控制机制。需在 CP0 中扩展三个专用寄存器，并增加一条专用配置指令 monitor，配合 sw 指令实现对特定内存区间的写入保护。 1. 新增 CP0 寄存器 系统复位后，以下三个寄存器均置为 0。          编号 寄存器名 功能描述 读写权限     18 DMBoundaryHI 监视区间上界 mfc0 可读；仅 monitor 可写   19 DMBoundaryLO 监视区间下界 mfc0 可读；仅 monitor 可写   20 DMEnable 监视使能控制字 mfc0 可读；仅 monitor 可写     mtc0：仅能写入原有的 12-15 号寄存器（SR, Cause, EPC, PrID ），写入...</div></div></div></a><a class="pagination-related" href="/2025/09/29/BUAA-CO%20Pre%E4%B8%8A%E6%9C%BA/" title="BUAA-CO Pre上机"><img class="cover" src="/img/covers/cover1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-29</div><div class="info-item-2">BUAA-CO Pre上机</div></div><div class="info-2"><div class="info-item-1">本节主要是掌握三个工具，三道题目依次为 Logisim、Verilog、MIPS。 课上题目 T1 推箱子 任务描述 我们需要在 Logisim 中设计一个软电路来模拟简易的推箱子游戏。游戏地图构建在一个二维平面直角坐标系中，范围是 \(0 \le x, y \le 5\) 的正方形区域（共 \(6 \times 6\) 个点）。 箱子的起始位置（包括 Reset 后）固定在 \((0,0)\)，目标位置固定在 \((5,5)\)。 地图中包含 6 个固定的障碍点，分别为：\((1,1)\)、\((1,2)\)、\((2,1)\)、\((3,4)\)、\((4,3)\)、\((4,4)\)。 控制逻辑 系统输入 \((dx, dy)\) 表示箱子的移动变化量，且保证只会出现 \((0,0)\)、\((1,0)\) 或 \((0,1)\) 这三种情况。 设当前坐标为 \((x, y)\)，则预期坐标为 \((x+dx, y+dy)\)：  如果预期坐标合法（即在地图边界内且不是障碍），则在下一周期将箱子移动到该位置； 如果预期坐标非法（越界或撞...</div></div></div></a><a class="pagination-related" href="/2025/10/13/BUAA-CO%20P0%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P0上机"><img class="cover" src="/img/covers/cover7.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-13</div><div class="info-item-2">BUAA-CO P0上机</div></div><div class="info-2"><div class="info-item-1">本节考查内容为 Logisim，一般是一道组合逻辑和两道时序逻辑，时序逻辑中一个是有限状态机。 课上题目 T1 起伏数列 任务描述 我们需要在 Logisim 中设计一个 Moore 型有限状态机，用于实时监测输入数列的波动趋势。输入 \(a\) 为 5 位无符号整数。 数列的初始值默认为 \(a_0 = 7\)。即复位后，读入的第一个数据 \(a_1\) 将与 7 进行比较。 判定逻辑 设当前输入为 \(a_{m}\)，上一周期输入为 \(a_{m-1}\)（题目保证相邻输入不相等）：  若 \(a_{m} &gt; a_{m-1}\)，记为“起”； 若 \(a_{m} &lt; a_{m-1}\)，记为“伏”。  我们需要检测的目标模式是 “起 \(\rightarrow\) 起 \(\rightarrow\) 伏 \(\rightarrow\) 起”。 状态机支持循环检测，即当前成功匹配序列的最后一个“起”，可以作为下一个序列的开头。 当且仅当最近四个周期的变化趋势严格满足“起起伏起”时，输出 output 为 1，其他情况 out...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Rigelius</div><div class="author-info-description">A blog about technology and life.</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Rigelius"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E4%B8%8A%E9%A2%98%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">课上题目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#t1-ccc"><span class="toc-number">1.1.</span> <span class="toc-text">T1 ccc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rtl"><span class="toc-number">1.1.1.</span> <span class="toc-text">RTL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#t2-cjoc"><span class="toc-number">1.2.</span> <span class="toc-text">T2 cjoc</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rtl-1"><span class="toc-number">1.2.1.</span> <span class="toc-text">RTL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#t3-ccs"><span class="toc-number">1.3.</span> <span class="toc-text">T3 ccs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rtl-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">RTL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">题目分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A9%E6%95%99%E9%97%AE%E7%AD%94"><span class="toc-number">3.</span> <span class="toc-text">助教问答</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%94%E8%80%85%E7%9A%84%E8%AF%9D"><span class="toc-number">4.</span> <span class="toc-text">笔者的话</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/09/BUAA-CO%20%E6%8E%A8%E8%8D%90%E9%A2%98%E7%9B%AE%E6%B1%87%E6%80%BB/" title="BUAA-CO 推荐题目汇总"><img src="/img/covers/cover1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUAA-CO 推荐题目汇总"/></a><div class="content"><a class="title" href="/2025/12/09/BUAA-CO%20%E6%8E%A8%E8%8D%90%E9%A2%98%E7%9B%AE%E6%B1%87%E6%80%BB/" title="BUAA-CO 推荐题目汇总">BUAA-CO 推荐题目汇总</a><time datetime="2025-12-09T14:00:00.000Z" title="发表于 2025-12-09 22:00:00">2025-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/08/BUAA-CO%20P7%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P7上机"><img src="/img/covers/cover10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUAA-CO P7上机"/></a><div class="content"><a class="title" href="/2025/12/08/BUAA-CO%20P7%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P7上机">BUAA-CO P7上机</a><time datetime="2025-12-08T14:00:00.000Z" title="发表于 2025-12-08 22:00:00">2025-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/01/BUAA-CO%20P6%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P6上机"><img src="/img/covers/cover14.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUAA-CO P6上机"/></a><div class="content"><a class="title" href="/2025/12/01/BUAA-CO%20P6%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P6上机">BUAA-CO P6上机</a><time datetime="2025-12-01T14:00:00.000Z" title="发表于 2025-12-01 22:00:00">2025-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/17/BUAA-CO%20P5%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P5上机"><img src="/img/covers/cover4.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUAA-CO P5上机"/></a><div class="content"><a class="title" href="/2025/11/17/BUAA-CO%20P5%E4%B8%8A%E6%9C%BA/" title="BUAA-CO P5上机">BUAA-CO P5上机</a><time datetime="2025-11-17T14:00:00.000Z" title="发表于 2025-11-17 22:00:00">2025-11-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/11/BUAA-OOpre%20%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/" title="BUAA-OOpre 课程总结"><img src="/img/covers/cover9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="BUAA-OOpre 课程总结"/></a><div class="content"><a class="title" href="/2025/11/11/BUAA-OOpre%20%E8%AF%BE%E7%A8%8B%E6%80%BB%E7%BB%93/" title="BUAA-OOpre 课程总结">BUAA-OOpre 课程总结</a><time datetime="2025-11-11T13:01:00.000Z" title="发表于 2025-11-11 21:01:00">2025-11-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/background.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By Rigelius</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div class="search-dialog" id="search-modal"><div class="search-dialog-wrapper"><div class="search-dialog-header"><h3 class="search-dialog-title">搜索</h3><button id="search-close" type="button">×</button></div><div class="search-dialog-input-wrap"><label class="search-input-label" for="search-input">关键词</label><input id="search-input" type="text" autocomplete="off"></div><div class="search-results" id="search-results"></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        loader: {
          load: [
            // Four font extension packages (optional)
            //- '[tex]/bbm',
            //- '[tex]/bboldx',
            //- '[tex]/dsfont',
            '[tex]/mhchem'
          ],
          paths: {
            'mathjax-newcm': '[mathjax]/../@mathjax/mathjax-newcm-font',

            //- // Four font extension packages (optional)
            //- 'mathjax-bbm-extension': '[mathjax]/../@mathjax/mathjax-bbm-font-extension',
            //- 'mathjax-bboldx-extension': '[mathjax]/../@mathjax/mathjax-bboldx-font-extension',
            //- 'mathjax-dsfont-extension': '[mathjax]/../@mathjax/mathjax-dsfont-font-extension',
            'mathjax-mhchem-extension': '[mathjax]/../@mathjax/mathjax-mhchem-font-extension'
          }
        },
        output: {
          font: 'mathjax-newcm',
        },
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
          packages: {
            '[+]': [
              'mhchem'
            ]
          }
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          menuOptions: {
            settings: {
              enrich: false  // Turn off Braille and voice narration text automatic generation
            }
          },
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'Rigelius/Rigelius.github.io',
      'data-repo-id': 'R_kgDOQ6-aAw',
      'data-category-id': 'DIC_kwDOQ6-aA84C1ESp',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><script src="/js/custom.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>